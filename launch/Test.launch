<?xml version="1.0" encoding="UTF-8"?> 
<!-- Simulated Hex+delta arm -->
<launch>
  <arg name="sim" default="true"/>
  <arg name="viz" default = "true"/>

  <include file="$(find tricopter)/launch/stabilisation.launch"/>

  <node pkg="tf2_ros" type="static_transform_publisher" name="transform_map2tracking" args="0 0 0.32 0 0 0 map camera_init" />

    <include file="$(find geometric_controller)/launch/geometric_controller.launch">
      <arg name="mav_name" default="Hex_delta"/>
      <arg name="command_input" default="2" />
      <arg name= "max_acc" default="2.0" />
      <!-- <arg name="Kp_x" default="5.0" />
      <arg name="Kp_y" default="5.0" />
      <arg name="Kp_z" default="12.0" />
      <arg name="Kv_x" default="1.7"/>
      <arg name="Kv_y" default="1.7"/>
      <arg name="Kv_z" default="15.0"/> -->
      <arg name="Kp_x" default="3.0" />
      <arg name="Kp_y" default="3.0" />
      <arg name="Kp_z" default="12.0" />
      <arg name="Kv_x" default="2.0"/>
      <arg name="Kv_y" default="2.0"/>
      <arg name="Kv_z" default="2.0"/>
      <arg name="normalizedthrust_constant" default="0.01"/> <!-- map thrust in N to [0,1] -->
      <arg name="normalizedthrust_offset" default="0.25"/>
      <arg name="attctrl_constant" default="0.5"/>
    </include>

    <node pkg="trajectory_publisher" type="trajectory_publisher" name="trajectory_publisher" output="screen">
      <param name="trajectory_type" value="1" />
      <param name="shape_omega" value="0.0" />
      <param name="initpos_z" value="2.0" />
      <param name="reference_type" value="2" />
    </node>
    
  <node name="tooltip_sp_publisher" pkg="tricopter" type="tooltip_sp_from_geometric_ctrl.py" required="true" output="screen"/>
  
  <group if="$(arg sim)">
    <param name="model_name" value="Hex_delta"/>
    <include file="$(find tricopter)/launch/spawn_gazebo.launch"/>
  </group>

  <!-- MAVROS -->
      <!-- MAVROS configs -->
      <arg name="fcu_url" default="udp://:14540@localhost:14557"/>
      <arg name="respawn_mavros" default="false"/>
  <include file="$(find mavros)/launch/px4.launch">
    <arg name="gcs_url" value=""/>
    <arg name="fcu_url" value="$(arg fcu_url)"/>
    <arg name="respawn_mavros" value="$(arg respawn_mavros)"/>
  </include>

  <group if="$(arg viz)">
    <!-- <node type="rviz" name="rviz" pkg="rviz" args="-d $(find tricopter)/rviz/AAM.rviz"/> -->
    <node name = "my_rqt_dashboard" pkg = "rqt_gui" type = "rqt_gui" respawn = "false" output = "screen" args = "--perspective-file $(find tricopter)/rqt/AAM.perspective"/>
  </group>

  <param name="mavros/vision_pose/tf/frame_id" value="camera_init" />
  <param name="mavros/setpoint_position/tf/frame_id" value="camera_init" />
  <param name="mavros/local_position/tf/frame_id" value="camera_init" />
  <param name="mavros/global_position/tf/frame_id" value="camera_init" />
  <param name="mavros/local_position/frame_id" value="camera_init" />
  <param name="mavros/global_position/frame_id" value="camera_init" />
  <param name="mavros/local_position/tf/send" value="True" />
</launch>